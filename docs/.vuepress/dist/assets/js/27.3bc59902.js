(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{432:function(s,a,t){"use strict";t.r(a);var n=t(2),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"nginx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx"}},[s._v("#")]),s._v(" Nginx")]),s._v(" "),a("h2",{attrs:{id:"nginx-简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx-简介"}},[s._v("#")]),s._v(" Nginx 简介")]),s._v(" "),a("h3",{attrs:{id:"什么是-nginx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是-nginx"}},[s._v("#")]),s._v(" 什么是 Nginx")]),s._v(" "),a("p",[s._v("Nginx 可以作为静态页面的 web 服务器，同时还支持 CGI 协议的动态语言，比如 perl、php 等。但是不支持 java。Java 程序只能通过与 tomcat 配合完成。")]),s._v(" "),a("p",[s._v("Nginx 是高性能的 HTTP 和反向代理的服务器，处理高并发能力是十分强大的，能经受高负 载的考验,有报告表明能支持高达 50,000 个并发连接数。")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://lnmp.org/nginx.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Nginx 简介"),a("OutboundLink")],1)]),s._v(" "),a("p",[a("a",{attrs:{href:"https://nginx.org/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Nginx官网"),a("OutboundLink")],1)]),s._v(" "),a("h3",{attrs:{id:"正向代理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#正向代理"}},[s._v("#")]),s._v(" 正向代理")]),s._v(" "),a("p",[s._v("正向代理：如果把局域网外的 Internet 想象成一个巨大的资源库，则局域网中的客户端要访 问 Internet，则需要通过代理服务器来访问，这种代理服务就称为正向代理。")]),s._v(" "),a("p",[a("strong",[s._v("需要在客户端配置代理服务器进行指定网站访问")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://typora-oss.yixihan.chat//img/202210302158748.png",alt:"image-20220113080407618"}})]),s._v(" "),a("h3",{attrs:{id:"反向代理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#反向代理"}},[s._v("#")]),s._v(" 反向代理")]),s._v(" "),a("p",[s._v("反向代理，其实客户端对代理是无感知的，因为客户端不需要任何配置就可以访问，我们只 需要将请求发送到反向代理服务器，由反向代理服务器去选择目标服务器获取数据后，在返 回给客户端，此时反向代理服务器和目标服务器对外就是一个服务器，"),a("strong",[s._v("暴露的是代理服务器 地址，隐藏了真实服务器 IP 地址")]),s._v("。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://typora-oss.yixihan.chat//img/202210302158861.png",alt:"image-20220113080908675"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://typora-oss.yixihan.chat//img/202210302158365.png",alt:"image-20220113080937075"}})]),s._v(" "),a("h3",{attrs:{id:"负载均衡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#负载均衡"}},[s._v("#")]),s._v(" 负载均衡")]),s._v(" "),a("p",[a("strong",[s._v("增加服务器的数量，然后将请求分发到各个服务器上，将原先请求集中到单个服务器上的 情况改为将请求分发到多个服务器上，将负载分发到不同的服务器，也就是我们所说的负载均衡")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://typora-oss.yixihan.chat//img/202210302158155.png",alt:"image-20220113081641151"}})]),s._v(" "),a("h3",{attrs:{id:"动静分离"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#动静分离"}},[s._v("#")]),s._v(" 动静分离")]),s._v(" "),a("p",[s._v("为了加快网站的解析速度，可以把动态页面和静态页面由不同的服务器来解析，加快解析速 度。降低原来单个服务器的压力。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://typora-oss.yixihan.chat//img/202210302158416.png",alt:"image-20220113082352406"}})]),s._v(" "),a("h2",{attrs:{id:"nginx-安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx-安装"}},[s._v("#")]),s._v(" Nginx 安装")]),s._v(" "),a("h3",{attrs:{id:"相关资源下载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#相关资源下载"}},[s._v("#")]),s._v(" 相关资源下载")]),s._v(" "),a("p",[a("a",{attrs:{href:"http://nginx.org/en/download.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Nginx下载地址"),a("OutboundLink")],1)]),s._v(" "),a("p",[a("a",{attrs:{href:"https://www.xshell.com/zh/all-downloads/",target:"_blank",rel:"noopener noreferrer"}},[s._v("xshell下载地址"),a("OutboundLink")],1)]),s._v(" "),a("h3",{attrs:{id:"nginx-安装-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx-安装-2"}},[s._v("#")]),s._v(" Nginx 安装")]),s._v(" "),a("blockquote",[a("p",[s._v("使用 xshell 连接 Linux 服务器")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://typora-oss.yixihan.chat//img/202210302158930.png",alt:"image-20220113083719353"}})]),s._v(" "),a("blockquote",[a("p",[s._v("安装  pcre 依赖")])]),s._v(" "),a("ol",[a("li",[a("p",[s._v("联网下载 pcre 压缩文件依赖")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" http://downloads.sourceforge.net/project/pcre/pcre/8.37/pcre-8.37.tar.gz\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("解压压缩文件")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-zxvf")]),s._v(" pcre-8.37.tar.gz\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("安装 pcre")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("./configure\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("查看 pcre 版本号")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("pcre-config "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--version")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://typora-oss.yixihan.chat//img/202210302158771.png",alt:"image-20220113083936915"}})])])]),s._v(" "),a("blockquote",[a("p",[s._v("安装 openssl 、zlib 、 gcc 依赖")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("yum "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" zlib zlib-devel gcc-c++ libtool openssl openssl-devel\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("blockquote",[a("p",[s._v("安装 Nginx")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-zxvf")]),s._v(" nginx-1.20.1.tar.gz\n./configure\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("blockquote",[a("p",[s._v("启动 Nginx")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/nginx/sbin\n./nginx \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("blockquote",[a("p",[s._v("访问 Nginx")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("http://yixihan.chat/\nhttp://110.42.138.132/\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("a",{attrs:{href:"http://yixihan.chat/",target:"_blank",rel:"noopener noreferrer"}},[s._v("url"),a("OutboundLink")],1)]),s._v(" "),a("p",[a("a",{attrs:{href:"http://110.42.138.132/",target:"_blank",rel:"noopener noreferrer"}},[s._v("url"),a("OutboundLink")],1)]),s._v(" "),a("p",[a("img",{attrs:{src:"https://typora-oss.yixihan.chat//img/202210302158797.png",alt:"image-20220113084643763"}})]),s._v(" "),a("blockquote",[a("p",[s._v("开放端口")])]),s._v(" "),a("p",[s._v("在 windows 系统中访问 linux 中 nginx，默认不能访问的，因为防火墙问题")]),s._v(" "),a("ol",[a("li",[s._v("关闭防火墙")]),s._v(" "),a("li",[s._v("开放访问的端口号，80 端口")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看开放的端口号")]),s._v("\nfirewall-cmd --list-all\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置开放的端口号")]),s._v("\nfirewall-cmd --add-service"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http –permanent\nfirewall-cmd --add-port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/tcp "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--permanent")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启防火墙")]),s._v("\nfirewall-cmd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--reload")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h2",{attrs:{id:"nginx-常用命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx-常用命令"}},[s._v("#")]),s._v(" Nginx 常用命令")]),s._v(" "),a("p",[s._v("ps : Nginx 所有操作都必须在 "),a("code",[s._v("/usr/local/nginx/sbin")]),s._v(" 目录中")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入 nginx 目录中")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/nginx/sbin\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1. 查看 nginx 版本号")]),s._v("\n./nginx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2. 启动 nginx")]),s._v("\n./nginx\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3. 停止 nginx")]),s._v("\n./nginx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" stop\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 4. 重新加载 nginx")]),s._v("\n./nginx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" reload\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 5. 查看 nginx 运行PID")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -ef"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" nginx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("h2",{attrs:{id:"nginx-配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx-配置文件"}},[s._v("#")]),s._v(" Nginx 配置文件")]),s._v(" "),a("h3",{attrs:{id:"nginx-配置文件位置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx-配置文件位置"}},[s._v("#")]),s._v(" Nginx 配置文件位置")]),s._v(" "),a("p",[a("code",[s._v("/usr/local/nginx/conf/nginx.conf")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /usr/local/nginx/conf/nginx.conf\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"nginx-配置文件内容"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx-配置文件内容"}},[s._v("#")]),s._v(" Nginx 配置文件内容")]),s._v(" "),a("p",[s._v("Nginx 配置文件分为三个部分")]),s._v(" "),a("ul",[a("li",[s._v("全局块")]),s._v(" "),a("li",[s._v("events 块")]),s._v(" "),a("li",[s._v("http 块")])]),s._v(" "),a("h4",{attrs:{id:"全局块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#全局块"}},[s._v("#")]),s._v(" 全局块")]),s._v(" "),a("p",[s._v("配置服务器整体运行的配置指令")]),s._v(" "),a("p",[s._v("比如 worker_processes 1;处理并发数的配置")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://typora-oss.yixihan.chat//img/202210302158985.png",alt:"image-20220113085630698"}})]),s._v(" "),a("h4",{attrs:{id:"events-块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#events-块"}},[s._v("#")]),s._v(" events 块")]),s._v(" "),a("p",[s._v("影响 Nginx 服务器与用户的网络连接")]),s._v(" "),a("p",[s._v("比如 worker_connections 1024 ==> 支持的最大连接数为 1024")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://typora-oss.yixihan.chat//img/202210302158488.png",alt:"image-20220113085702413"}})]),s._v(" "),a("h4",{attrs:{id:"http-块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#http-块"}},[s._v("#")]),s._v(" http 块")]),s._v(" "),a("p",[s._v("这算是 Nginx 服务器配置中最频繁的部分，代理、缓存和日志定义等绝大多数功能和第三方模块的配置都在这里。")]),s._v(" "),a("p",[s._v("http 块还包含两部分： http 全局块 server 块")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://typora-oss.yixihan.chat//img/202210302159846.png",alt:"image-20220113090128792"}})]),s._v(" "),a("blockquote",[a("p",[s._v("http 全局块")])]),s._v(" "),a("p",[s._v("http 全局块配置的指令包括文件引入、MIME-TYPE 定义、日志自定义、连接超时时间、单链接请求数上限等。")]),s._v(" "),a("blockquote",[a("p",[s._v("server 块")])]),s._v(" "),a("p",[s._v("这块和虚拟主机有密切关系，虚拟主机从用户角度看，和一台独立的硬件主机是完全一样的，该技术的产生是为了 节省互联网服务器硬件成本。")]),s._v(" "),a("p",[s._v("每个 http 块可以包括多个 server 块，而每个 server 块就相当于一个虚拟主机。")]),s._v(" "),a("p",[s._v("而每个 server 块也分为全局 server 块，以及可以同时包含多个 locaton 块。")]),s._v(" "),a("p",[s._v("这块的主要作用是基于 Nginx 服务器接收到的请求字符串（例如 server_name/uri-string），对虚拟主机名称 （也可以是 IP 别名）之外的字符串（例如 前面的 /uri-string）进行匹配，对特定的请求进行处理。地址定向、数据缓 存和应答控制等功能，还有许多第三方模块的配置也在这里进行。")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("全局 server 块\n最常见的配置是本虚拟机主机的监听配置和本虚拟主机的名称或 IP 配置。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://typora-oss.yixihan.chat//img/202210302159825.png",alt:"image-20220113085913442"}})])]),s._v(" "),a("li",[a("p",[s._v("location 块")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://typora-oss.yixihan.chat//img/202210302159662.png",alt:"image-20220113085953508"}})])])]),s._v(" "),a("h2",{attrs:{id:"nginx-配置实例-反向代理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx-配置实例-反向代理"}},[s._v("#")]),s._v(" Nginx 配置实例 - 反向代理")]),s._v(" "),a("h3",{attrs:{id:"反向代理实例一"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#反向代理实例一"}},[s._v("#")]),s._v(" 反向代理实例一")]),s._v(" "),a("blockquote",[a("p",[s._v("实现效果")])]),s._v(" "),a("p",[s._v("实现效果：使用 nginx 反向代理，访问 www.123.com 直接跳转到服务器的127.0.0.1:8080")]),s._v(" "),a("h4",{attrs:{id:"准备工作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#准备工作"}},[s._v("#")]),s._v(" 准备工作")]),s._v(" "),a("blockquote",[a("p",[s._v("安装 tomcat 并启动")])]),s._v(" "),a("p",[s._v("ps : 需要有 jdk")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://tomcat.apache.org/download-90.cgi",target:"_blank",rel:"noopener noreferrer"}},[s._v("linux 版 tomcat 下载"),a("OutboundLink")],1)]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-zxvf")]),s._v(" apache-tomcat-9.0.43.tar.gz\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" apache-tomcat-9.0.43/bin/\n./startup.sh\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("blockquote",[a("p",[s._v("对外开放 8080 端口")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("firewall-cmd --add-port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("/tcp "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--permanent")]),s._v("\nfirewall-cmd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--reload")]),s._v("\nfirewall-cmd --list-all\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("blockquote",[a("p",[s._v("访问 tomcat")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://typora-oss.yixihan.chat//img/202210302159627.png",alt:"image-20220113091337863"}})]),s._v(" "),a("h4",{attrs:{id:"访问过程分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#访问过程分析"}},[s._v("#")]),s._v(" 访问过程分析")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://typora-oss.yixihan.chat//img/202210302159234.png",alt:"image-20220113091532023"}})]),s._v(" "),a("h4",{attrs:{id:"具体配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#具体配置"}},[s._v("#")]),s._v(" 具体配置")]),s._v(" "),a("blockquote",[a("p",[s._v("在 windows 系统的 host 文件进行域名和 ip 对应关系的配置")])]),s._v(" "),a("ol",[a("li",[a("p",[s._v("打开 host 文件\nhost 文件位置 : "),a("code",[s._v("C:\\Windows\\System32\\drivers\\etc")]),s._v(" "),a("img",{attrs:{src:"https://typora-oss.yixihan.chat//img/202210302159878.png",alt:"image-20220113091707126"}})])]),s._v(" "),a("li",[a("p",[s._v("添加内容")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# nginx 学习 (主机名 IP 地址 域名) \n110.42.138.132 www.123.com\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://typora-oss.yixihan.chat//img/202210302159993.png",alt:"image-20220113091948748"}})])]),s._v(" "),a("li",[a("p",[s._v("测试访问\n"),a("img",{attrs:{src:"https://typora-oss.yixihan.chat//img/202210302159982.png",alt:"image-20220113093605013"}}),s._v(" "),a("img",{attrs:{src:"https://typora-oss.yixihan.chat//img/202210302159659.png",alt:"image-20220113093621987"}})])])]),s._v(" "),a("blockquote",[a("p",[s._v("修改 nginx.conf 配置并重新加载 nginx")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 打开 nginx.conf")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /usr/local/nginx/conf/nginx.conf\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改配置")]),s._v("\nserver_name 主机IP地址"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nproxy_pass http://127.0.0.1:8080"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重新加载 nginx")]),s._v("\n/usr/local/nginx/sbin/nginx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" reload\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://typora-oss.yixihan.chat//img/202210302159279.png",alt:"image-20220113092926347"}})]),s._v(" "),a("blockquote",[a("p",[s._v("测试")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://typora-oss.yixihan.chat//img/202210302159125.png",alt:"image-20220113093707259"}})]),s._v(" "),a("h3",{attrs:{id:"反向代理实例二"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#反向代理实例二"}},[s._v("#")]),s._v(" 反向代理实例二")]),s._v(" "),a("blockquote",[a("p",[s._v("实现效果")])]),s._v(" "),a("p",[s._v("使用 nginx 反向代理，根据访问的路径跳转到不同端口的服务中")]),s._v(" "),a("p",[s._v("nginx 监听端口为 9001")]),s._v(" "),a("p",[s._v("访问 http://110.42.138.132:9001/edu/ 直接跳转到 127.0.0.1:8080")]),s._v(" "),a("p",[s._v("访问 http:// 110.42.138.132:9001/vod/ 直接跳转到 127.0.0.1:8081")]),s._v(" "),a("h4",{attrs:{id:"准备工作-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#准备工作-2"}},[s._v("#")]),s._v(" 准备工作")]),s._v(" "),a("ol",[a("li",[s._v("准备两个 tomcat 服务器，一个 8080 端口，一个 8081 端口")]),s._v(" "),a("li",[s._v("创建文件夹和测试页面")])]),s._v(" "),a("blockquote",[a("p",[s._v("测试")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://typora-oss.yixihan.chat//img/202210302159215.png",alt:"image-20220113100750534"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://typora-oss.yixihan.chat//img/202210302159163.png",alt:"image-20220113100741063"}})]),s._v(" "),a("h4",{attrs:{id:"具体配置-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#具体配置-2"}},[s._v("#")]),s._v(" 具体配置")]),s._v(" "),a("blockquote",[a("p",[s._v("修改 nginx.conf 配置并重新加载 nginx")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 打开 nginx.conf")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /usr/local/nginx/conf/nginx.conf\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改配置")]),s._v("\nserver "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\tlisten "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9001")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\tserver_name "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("110.42")]),s._v(".138.132"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n\tlocation ~ /edu/ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\tproxy_pass http://127.0.0.1:8080"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\tlocation ~ /vod/ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\tproxy_pass http://127.0.0.1:8081"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重新加载 nginx")]),s._v("\n/usr/local/nginx/sbin/nginx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" reload\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://typora-oss.yixihan.chat//img/202210302159789.png",alt:"image-20220113095718444"}})]),s._v(" "),a("blockquote",[a("p",[s._v("开放端口号")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("firewall-cmd --add-port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8081")]),s._v("/tcp "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--permanent")]),s._v("\nfirewall-cmd --add-port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9001")]),s._v("/tcp "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--permanent")]),s._v("\nfirewall "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-cmd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--reload")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("blockquote",[a("p",[s._v("测试")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://typora-oss.yixihan.chat//img/202210302159595.png",alt:"image-20220113100721836"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://typora-oss.yixihan.chat//img/202210302200090.png",alt:"image-20220113100659664"}})]),s._v(" "),a("h3",{attrs:{id:"location-指令说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#location-指令说明"}},[s._v("#")]),s._v(" location 指令说明")]),s._v(" "),a("p",[s._v("该指令用于匹配 URL。")]),s._v(" "),a("p",[s._v("语法如下：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("location "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ~ "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ~* "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ^~ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" uri "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("ul",[a("li",[s._v("= ：用于不含正则表达式的 uri 前，要求请求字符串与 uri 严格匹配，如果匹配 成功，就停止继续向下搜索并立即处理该请求。")]),s._v(" "),a("li",[s._v("~：用于表示 uri 包含正则表达式，并且区分大小写。")]),s._v(" "),a("li",[s._v("~*：用于表示 uri 包含正则表达式，并且不区分大小写。")]),s._v(" "),a("li",[s._v("^~：用于不含正则表达式的 uri 前，要求 Nginx 服务器找到标识 uri 和请求字 符串匹配度最高的 location 后，立即使用此 location 处理请求，而不再使用 location 块中的正则 uri 和请求字符串做匹配。")])]),s._v(" "),a("p",[a("em",[a("em",[s._v("注意：如果 uri 包含正则表达式，则必须要有 ~ 或者 ~")]),s._v(" 标识")]),s._v("*")]),s._v(" "),a("h2",{attrs:{id:"nginx-配置实例-负载均衡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx-配置实例-负载均衡"}},[s._v("#")]),s._v(" Nginx 配置实例 - 负载均衡")]),s._v(" "),a("blockquote",[a("p",[s._v("实现效果")])]),s._v(" "),a("p",[s._v("浏览器地址栏输入地址 http://110.42.138.132/edu/a.html，负载均衡效果，平均 8080 和 8081 端口中")]),s._v(" "),a("h3",{attrs:{id:"准备工作-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#准备工作-3"}},[s._v("#")]),s._v(" 准备工作")]),s._v(" "),a("ol",[a("li",[s._v("准备两台 tomcat 服务器，一台 8080，一台 8081")]),s._v(" "),a("li",[s._v("在两台 tomcat 里面 webapps 目录中，创建名称是 edu 文件夹，在 edu 文件夹中创建 页面 a.html，用于测试")])]),s._v(" "),a("blockquote",[a("p",[s._v("测试")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://typora-oss.yixihan.chat//img/202210302200162.png",alt:"image-20220113101703849"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://typora-oss.yixihan.chat//img/202210302200998.png",alt:"image-20220113101709278"}})]),s._v(" "),a("h3",{attrs:{id:"具体配置-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#具体配置-3"}},[s._v("#")]),s._v(" 具体配置")]),s._v(" "),a("blockquote",[a("p",[s._v("修改 nginx.conf 配置并重新加载 nginx")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 打开 nginx.conf")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /usr/local/nginx/conf/nginx.conf\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改配置")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 负载均衡配置 (nginx 学习)")]),s._v("\nupstream myserver "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\tserver "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("110.42")]),s._v(".138.132:8080"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\tserver "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("110.42")]),s._v(".138.132:8081"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nproxy_pass http://myserver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重新加载 nginx")]),s._v("\n/usr/local/nginx/sbin/nginx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" reload\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://typora-oss.yixihan.chat//img/202210302200694.png",alt:"image-20220113102127692"}})]),s._v(" "),a("blockquote",[a("p",[s._v("测试")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://typora-oss.yixihan.chat//img/202210302200007.png",alt:"image-20220113102224533"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://typora-oss.yixihan.chat//img/202210302200521.png",alt:"image-20220113102231982"}})]),s._v(" "),a("h3",{attrs:{id:"nginx-负载均衡分配方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx-负载均衡分配方式"}},[s._v("#")]),s._v(" Nginx 负载均衡分配方式")]),s._v(" "),a("p",[s._v("随着互联网信息的爆炸性增长，负载均衡（load balance）已经不再是一个很陌生的话题， 顾名思义，负载均衡即是将负载分摊到不同的服务单元，既保证服务的可用性，又保证响应 足够快，给用户很好的体验。快速增长的访问量和数据流量催生了各式各样的负载均衡产品， 很多专业的负载均衡硬件提供了很好的功能，但却价格不菲，这使得负载均衡软件大受欢迎， nginx 就是其中的一个，在 linux 下有 Nginx、LVS、Haproxy 等等服务可以提供负载均衡服 务，而且 Nginx 提供了几种分配方式(策略)：")]),s._v(" "),a("h4",{attrs:{id:"轮询-默认"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#轮询-默认"}},[s._v("#")]),s._v(" 轮询（默认）")]),s._v(" "),a("p",[s._v("每个请求按时间顺序逐一分配到不同的后端服务器，如果后端服务器 down 掉，能自动剔除。")]),s._v(" "),a("h4",{attrs:{id:"weight"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#weight"}},[s._v("#")]),s._v(" weight")]),s._v(" "),a("p",[s._v("weight 代表权,重默认为 1,权重越高被分配的客户端越多 指定轮询几率，weight 和访问比率成正比，用于后端服务器性能不均的情况。")]),s._v(" "),a("p",[s._v("例如：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("upstream server_pool"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\tserver "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".5.21 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("weight")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\tserver "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".5.22 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("weight")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h4",{attrs:{id:"ip-hash"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ip-hash"}},[s._v("#")]),s._v(" ip_hash")]),s._v(" "),a("p",[s._v("每个请求"),a("strong",[s._v("按访问 ip 的 hash 结果")]),s._v("分配，这样每个访客固定访问一个后端服务器，可以解决 session 的问题。")]),s._v(" "),a("p",[s._v("例如：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("upstream server_pool"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\tip_hash"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\tserver "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".5.21:80"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\tserver "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".5.22:80"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h4",{attrs:{id:"fair-第三方"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#fair-第三方"}},[s._v("#")]),s._v(" fair（第三方）")]),s._v(" "),a("p",[s._v("按"),a("strong",[s._v("后端服务器的响应时间")]),s._v("来分配请求，响应时间短的优先分配。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("upstream server_pool"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\tserver "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".5.21:80"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\tserver "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".5.22:80"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\tfair"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h2",{attrs:{id:"nginx-配置实例-动静分离"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx-配置实例-动静分离"}},[s._v("#")]),s._v(" Nginx 配置实例 - 动静分离")]),s._v(" "),a("h3",{attrs:{id:"动静分离简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#动静分离简介"}},[s._v("#")]),s._v(" 动静分离简介")]),s._v(" "),a("p",[s._v("Nginx 动静分离简单来说就是把动态跟静态请求分开，不能理解成只是单纯的把动态页面和 静态页面物理分离。严格意义上说应该是动态请求跟静态请求分开，可以理解成使用 Nginx 处理静态页面，Tomcat 处理动态页面。")]),s._v(" "),a("blockquote",[a("p",[s._v("Nginx 动静分离的两种方式")])]),s._v(" "),a("ul",[a("li",[s._v("纯粹把静态文件独立成单独的域名，放在独立的服务器上 (主流)")]),s._v(" "),a("li",[s._v("动态跟静态文件混合在一起发布，通过 nginx 来分开")])]),s._v(" "),a("blockquote",[a("p",[s._v("实现方法")])]),s._v(" "),a("p",[s._v("通过 location 指定不同的后缀名实现不同的请求转发。通过 expires 参数设置，可以使 浏览器缓存过期时间，减少与服务器之前的请求和流量。具体 Expires 定义：是给一个资 源设定一个过期时间，也就是说无需去服务端验证，直接通过浏览器自身确认是否过期即可， 所以不会产生额外的流量。此种方法非常适合不经常变动的资源。（如果经常更新的文件， 不建议使用 Expires 来缓存），我这里设置 3d，表示在这 3 天之内访问这个 URL，发送 一个请求，比对服务器该文件最后更新时间没有变化，则不会从服务器抓取，返回状态码 304，如果有修改，则直接从服务器重新下载，返回状态码 200。")]),s._v(" "),a("blockquote",[a("p",[s._v("图解")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://typora-oss.yixihan.chat//img/202210302200265.png",alt:"image-20220113103324065"}})]),s._v(" "),a("h3",{attrs:{id:"准备工作-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#准备工作-4"}},[s._v("#")]),s._v(" 准备工作")]),s._v(" "),a("ol",[a("li",[s._v("在 liunx 系统中准备静态资源，用于进行访问")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://typora-oss.yixihan.chat//img/202210302200283.png",alt:"image-20220113104146968"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://typora-oss.yixihan.chat//img/202210302200093.png",alt:"image-20220113104158833"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://typora-oss.yixihan.chat//img/202210302200944.png",alt:"image-20220113104211194"}})]),s._v(" "),a("h3",{attrs:{id:"具体配置-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#具体配置-4"}},[s._v("#")]),s._v(" 具体配置")]),s._v(" "),a("blockquote",[a("p",[s._v("修改 nginx.conf 配置并重新加载 nginx")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 打开 nginx.conf")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /usr/local/nginx/conf/nginx.conf\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改配置")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 负载均衡配置 (nginx 学习)")]),s._v("\nlocation /2D/ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\troot /picture/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\tautoindex on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\texpires 3d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nlocation /me/ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\troot /picture/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 表示是否将所有资源以列表的形式列举出来")]),s._v("\n\tautoindex on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nlocation /www/ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\troot /picture/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\tautoindex on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\tindex index.html index.htm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重新加载 nginx")]),s._v("\n/usr/local/nginx/sbin/nginx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" reload\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://typora-oss.yixihan.chat//img/202210302200497.png",alt:"image-20220113111229457"}})]),s._v(" "),a("blockquote",[a("p",[s._v("测试")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://typora-oss.yixihan.chat//img/202210302200135.png",alt:"image-20220113111257631"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://typora-oss.yixihan.chat//img/202210302200631.png",alt:"image-20220113111315266"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://typora-oss.yixihan.chat//img/202210302200458.png",alt:"image-20220113111352585"}})]),s._v(" "),a("h2",{attrs:{id:"nginx-配置实例-高可用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx-配置实例-高可用"}},[s._v("#")]),s._v(" Nginx 配置实例 - 高可用")]),s._v(" "),a("h3",{attrs:{id:"高可用简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#高可用简介"}},[s._v("#")]),s._v(" 高可用简介")]),s._v(" "),a("blockquote",[a("p",[s._v("问题")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://typora-oss.yixihan.chat//img/202210302200113.png",alt:"image-20220113112632352"}})]),s._v(" "),a("blockquote",[a("p",[s._v("高可用")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://typora-oss.yixihan.chat//img/202210302200499.png",alt:"image-20220113113453436"}})]),s._v(" "),a("h3",{attrs:{id:"准备工作-5"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#准备工作-5"}},[s._v("#")]),s._v(" 准备工作")]),s._v(" "),a("ol",[a("li",[s._v("两台 nginx 服务器\n服务器 1 : 110.42.138.132\n服务器 2 : 1.117.145.128")]),s._v(" "),a("li",[s._v("安装 nginx")]),s._v(" "),a("li",[s._v("安装 keepalived")])]),s._v(" "),a("blockquote",[a("p",[s._v("安装 keepalived")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装 keepalived")]),s._v("\nyum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" keepalived –y\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 检测 keeypalived")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rpm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-q")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" keepalived\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://typora-oss.yixihan.chat//img/202210302200358.png",alt:"image-20220113115044111"}})]),s._v(" "),a("h3",{attrs:{id:"具体配置-5"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#具体配置-5"}},[s._v("#")]),s._v(" 具体配置")]),s._v(" "),a("blockquote",[a("p",[s._v("修改 keepalived")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /etc/keepalived/\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" keepalived.conf \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("具体配置 :")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" Configuration File "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" keepalived\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 全局定义")]),s._v("\nglobal_defs "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n   notification_email "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n     acassen@firewall.loc\n     failover@firewall.loc\n     sysadmin@firewall.loc\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n   notification_email_from Alexandre.Cassen@firewall.loc\n   smtp_server "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".200.1\n   smtp_connect_timeout "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 访问到主机 LVS_DEVEL 主机名字")]),s._v("\n   router_id LVS_DEVEL\n   vrrp_skip_check_adv_addr\n   vrrp_strict\n   vrrp_garp_interval "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n   vrrp_gna_interval "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 检测脚本")]),s._v("\nvrrp_script chk_http_port "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n \tscript "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/local/src/nginx_check.sh"')]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#（检测脚本执行的间隔）")]),s._v("\n \tinterval "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" \n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 权重")]),s._v("\n \tweight "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 虚拟 IP 配置")]),s._v("\nvrrp_instance VI_1 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 备份服务器上将 MASTER 改为 BACKUP ")]),s._v("\n    state MASTER\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 访问的网卡")]),s._v("\n    interface eth0\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 主、备机的 virtual_router_id 必须相同")]),s._v("\n    virtual_router_id "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("51")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 主、备机取不同的优先级，主机值较大，备份机值较小")]),s._v("\n    priority "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n    advert_int "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n    authentication "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        auth_type PASS\n        auth_pass "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1111")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# VRRP H 虚拟地址 ")]),s._v("\n    virtual_ipaddress "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    \t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 主服务器, 备服务器, 虚拟地址需要在一个网段里面")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".200.16\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br")])]),a("blockquote",[a("p",[s._v("添加脚本")])]),s._v(" "),a("p",[s._v("检测脚本添加位置 "),a("code",[s._v("/usr/local/src")])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("A")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-C")]),s._v(" nginx –no-header "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wc")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$A")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-eq")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n    /usr/local/nginx/sbin/nginx\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-C")]),s._v(" nginx --no-header "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wc")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-eq")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("killall")]),s._v(" keepalived\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("blockquote",[a("p",[s._v("启动 nginx 和 keepalived")])]),s._v(" "),a("p",[s._v("启动 keepalived")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("systemctl start keepalived.service\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -ef"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" keepalived\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("启动 nginx")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("/usr/local/nginx/sbin/nginx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("blockquote",[a("p",[s._v("测试")])]),s._v(" "),a("p",[s._v("因服务器不在一个网段, 无法测试")]),s._v(" "),a("h2",{attrs:{id:"nginx-原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx-原理"}},[s._v("#")]),s._v(" Nginx 原理")]),s._v(" "),a("h3",{attrs:{id:"master-worker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#master-worker"}},[s._v("#")]),s._v(" master & worker")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://typora-oss.yixihan.chat//img/202210302200480.png",alt:"image-20220114075215939"}})]),s._v(" "),a("blockquote",[a("p",[s._v("worke 工作机制")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://typora-oss.yixihan.chat//img/202210302200343.png",alt:"image-20220114075230431"}})]),s._v(" "),a("blockquote",[a("p",[s._v("master-workers 的机制的好处")])]),s._v(" "),a("ul",[a("li",[s._v("可以使用 nginx –s reload 热部署，利用 nginx 进行热部署操作")]),s._v(" "),a("li",[s._v("每个 woker 是独立的进程，如果有其中的一个 woker 出现问题，其他 woker 独立的， 继续进行争抢，实现请求过程，不会造成服务中断")])]),s._v(" "),a("h3",{attrs:{id:"设置多少个-woker-合适"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#设置多少个-woker-合适"}},[s._v("#")]),s._v(" 设置多少个 woker 合适")]),s._v(" "),a("p",[s._v("worker 数和服务器的 cpu 数相等是最为适宜的")]),s._v(" "),a("blockquote",[a("p",[s._v("设置 worker 数量")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("worker_processes "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#work 绑定 cpu(4 work 绑定 4cpu)。")]),s._v("\nworker_cpu_affinity 0001 0010 0100 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#work 绑定 cpu (4 work 绑定 8cpu 中的 4 个) 。")]),s._v("\nworker_cpu_affinity 0000001 00000010 00000100 00001000\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("blockquote",[a("p",[s._v("连接数 worker_connection")])]),s._v(" "),a("p",[s._v("问 : 发送请求，占用了 woker 的几个连接数？")]),s._v(" "),a("p",[s._v("答 : 2 或者 4 个")]),s._v(" "),a("p",[s._v("问 : nginx 有一个 master，有四个 woker，每个 woker 支持最大的连接数 1024，支持的 最大并发数是多少？")]),s._v(" "),a("p",[s._v("答 : 普通的静态访问最大并发数是： worker_connections  *  worker_processes  / 2，而如果是 HTTP 作 为反向代理来说，最大并发数量应该是 worker_connections  *  worker_processes / 4。")]),s._v(" "),a("h3",{attrs:{id:"nginx-conf-结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx-conf-结构"}},[s._v("#")]),s._v(" nginx.conf 结构")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://typora-oss.yixihan.chat//img/202210302200165.png",alt:"image-20220114075712088"}})])])}),[],!1,null,null,null);a.default=e.exports}}]);