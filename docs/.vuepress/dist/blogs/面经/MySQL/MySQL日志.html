<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MySQL - 日志 | 摸鱼小屋</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="花开亦花散">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.392636e6.css" as="style"><link rel="preload" href="/assets/js/app.d7bd471b.js" as="script"><link rel="preload" href="/assets/js/3.e4073929.js" as="script"><link rel="preload" href="/assets/js/1.de47dd8b.js" as="script"><link rel="preload" href="/assets/js/40.24ac40da.js" as="script"><link rel="prefetch" href="/assets/js/10.672405fe.js"><link rel="prefetch" href="/assets/js/11.0945fe29.js"><link rel="prefetch" href="/assets/js/12.4d6e4613.js"><link rel="prefetch" href="/assets/js/13.07fa234f.js"><link rel="prefetch" href="/assets/js/14.a48965e1.js"><link rel="prefetch" href="/assets/js/15.46eefb3e.js"><link rel="prefetch" href="/assets/js/16.ce4b366e.js"><link rel="prefetch" href="/assets/js/17.94f32748.js"><link rel="prefetch" href="/assets/js/18.7c2b4f54.js"><link rel="prefetch" href="/assets/js/19.c7ed148c.js"><link rel="prefetch" href="/assets/js/20.7f562445.js"><link rel="prefetch" href="/assets/js/21.352223ac.js"><link rel="prefetch" href="/assets/js/22.02a85236.js"><link rel="prefetch" href="/assets/js/23.8bb3e093.js"><link rel="prefetch" href="/assets/js/24.a4af8b65.js"><link rel="prefetch" href="/assets/js/25.839567da.js"><link rel="prefetch" href="/assets/js/26.6a7f4191.js"><link rel="prefetch" href="/assets/js/27.e4ae35b1.js"><link rel="prefetch" href="/assets/js/28.34d7462c.js"><link rel="prefetch" href="/assets/js/29.2f951596.js"><link rel="prefetch" href="/assets/js/30.2f0173d5.js"><link rel="prefetch" href="/assets/js/31.e84126bc.js"><link rel="prefetch" href="/assets/js/32.63c79bac.js"><link rel="prefetch" href="/assets/js/33.8871772f.js"><link rel="prefetch" href="/assets/js/34.f866a563.js"><link rel="prefetch" href="/assets/js/35.d2861409.js"><link rel="prefetch" href="/assets/js/36.3c0eb29e.js"><link rel="prefetch" href="/assets/js/37.89c1b6a9.js"><link rel="prefetch" href="/assets/js/38.896121e7.js"><link rel="prefetch" href="/assets/js/39.0b362766.js"><link rel="prefetch" href="/assets/js/4.1c403fee.js"><link rel="prefetch" href="/assets/js/41.6940145c.js"><link rel="prefetch" href="/assets/js/42.819c7eee.js"><link rel="prefetch" href="/assets/js/43.85f9e396.js"><link rel="prefetch" href="/assets/js/44.32d7ecf3.js"><link rel="prefetch" href="/assets/js/5.ba9c2a3c.js"><link rel="prefetch" href="/assets/js/6.7bc1a28c.js"><link rel="prefetch" href="/assets/js/7.7d67996f.js"><link rel="prefetch" href="/assets/js/8.1e07915a.js"><link rel="prefetch" href="/assets/js/9.be53e664.js">
    <link rel="stylesheet" href="/assets/css/0.styles.392636e6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-7dd95ae2><div data-v-7dd95ae2><div class="password-shadow password-wrapper-out" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>摸鱼小屋</h3> <p class="description" data-v-59e6cb88>花开亦花散</p> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>易曦翰</span>
          
        <!---->
        2022
      </a></span></div></div> <div class="hide" data-v-7dd95ae2><header class="navbar" data-v-7dd95ae2><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/yixihan.png" alt="摸鱼小屋" class="logo"> <span class="site-name">摸鱼小屋</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/Go/" class="nav-link"><i class="undefined"></i>
  Go
</a></li><li class="dropdown-item"><!----> <a href="/categories/Java/" class="nav-link"><i class="undefined"></i>
  Java
</a></li><li class="dropdown-item"><!----> <a href="/categories/MySQL/" class="nav-link"><i class="undefined"></i>
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/categories/Nginx/" class="nav-link"><i class="undefined"></i>
  Nginx
</a></li><li class="dropdown-item"><!----> <a href="/categories/编程环境搭建/" class="nav-link"><i class="undefined"></i>
  编程环境搭建
</a></li><li class="dropdown-item"><!----> <a href="/categories/RabbitMQ/" class="nav-link"><i class="undefined"></i>
  RabbitMQ
</a></li><li class="dropdown-item"><!----> <a href="/categories/面经/" class="nav-link"><i class="undefined"></i>
  面经
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间线
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont icon-gongju"></i>
      工具箱
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://xpdf.net/?s" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  PDF转Word
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://tool.lu/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  在线工具箱
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://openyyy.com/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  音乐格式转换
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.shopify.com/tools/logo-maker" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  logo 生成
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://sms-activate.ru/cn/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  虚拟短信接收
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://fanyi.phpstudyhelper.com/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  代码变量名称翻译
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-account"></i>
      关于
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/yixihan" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/yixihan" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-mayun"></i>
  gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-7dd95ae2></div> <aside class="sidebar" data-v-7dd95ae2><div class="personal-info-wrapper" data-v-1fad0c41 data-v-7dd95ae2><img src="/yixihan.png" alt="author-avatar" class="personal-img" data-v-1fad0c41> <h3 class="name" data-v-1fad0c41>
    易曦翰
  </h3> <div class="num" data-v-1fad0c41><div data-v-1fad0c41><h3 data-v-1fad0c41>34</h3> <h6 data-v-1fad0c41>文章</h6></div> <div data-v-1fad0c41><h3 data-v-1fad0c41>32</h3> <h6 data-v-1fad0c41>标签</h6></div></div> <ul class="social-links" data-v-1fad0c41></ul> <hr data-v-1fad0c41></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/Go/" class="nav-link"><i class="undefined"></i>
  Go
</a></li><li class="dropdown-item"><!----> <a href="/categories/Java/" class="nav-link"><i class="undefined"></i>
  Java
</a></li><li class="dropdown-item"><!----> <a href="/categories/MySQL/" class="nav-link"><i class="undefined"></i>
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/categories/Nginx/" class="nav-link"><i class="undefined"></i>
  Nginx
</a></li><li class="dropdown-item"><!----> <a href="/categories/编程环境搭建/" class="nav-link"><i class="undefined"></i>
  编程环境搭建
</a></li><li class="dropdown-item"><!----> <a href="/categories/RabbitMQ/" class="nav-link"><i class="undefined"></i>
  RabbitMQ
</a></li><li class="dropdown-item"><!----> <a href="/categories/面经/" class="nav-link"><i class="undefined"></i>
  面经
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间线
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont icon-gongju"></i>
      工具箱
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://xpdf.net/?s" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  PDF转Word
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://tool.lu/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  在线工具箱
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://openyyy.com/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  音乐格式转换
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.shopify.com/tools/logo-maker" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  logo 生成
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://sms-activate.ru/cn/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  虚拟短信接收
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://fanyi.phpstudyhelper.com/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  代码变量名称翻译
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-account"></i>
      关于
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/yixihan" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/yixihan" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-mayun"></i>
  gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <ul class="sidebar-links"><li><a href="/blogs/面经/MySQL/MySQLMVCC.html" class="sidebar-link">MySQL - MVCC</a></li><li><a href="/blogs/面经/MySQL/MySQL事务.html" class="sidebar-link">MySQL - 事务</a></li><li><a href="/blogs/面经/MySQL/MySQL优化.html" class="sidebar-link">MySQL - 优化</a></li><li><a href="/blogs/面经/MySQL/MySQL日志.html" class="active sidebar-link">MySQL - 日志</a></li><li><a href="/blogs/面经/MySQL/MySQL索引.html" class="sidebar-link">MySQL - 索引</a></li><li><a href="/blogs/面经/MySQL/MySQL面经.html" class="sidebar-link">MySQL - 面经</a></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>MySQL - 日志</h3> <!----> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>易曦翰</span>
          
        <!---->
        2022
      </a></span></div></div> <div data-v-7dd95ae2><div data-v-7dd95ae2><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">MySQL - 日志</h1> <div data-v-8a445198><i class="iconfont reco-account" data-v-8a445198><span data-v-8a445198>易曦翰</span></i> <i class="iconfont reco-date" data-v-8a445198><span data-v-8a445198>2022/10/30</span></i> <!----> <i class="tags iconfont reco-tag" data-v-8a445198><span class="tag-item" data-v-8a445198>MySQL</span><span class="tag-item" data-v-8a445198>面经</span></i></div></div> <div class="theme-reco-content content__default"><hr> <h1 id="mysql-日志"><a href="#mysql-日志" class="header-anchor">#</a> MySQL - 日志</h1> <p><code>MySQL</code> 日志主要包含 ==错误日志==, ==查询日志==, ==慢查询日志==, ==事务日志==, ==二进制日志== 几大类.</p> <p>其中比较重要的为这三大日志</p> <ul><li><strong>二进制日志  ==bin log== (归档日志)</strong></li> <li><strong>事务日志 ==redo log== (重做日志)</strong></li> <li>**回滚日志 ==undo log== **</li></ul> <blockquote><p>图示</p></blockquote> <p><img src="https://typora-photo-yixihan.oss-cn-chengdu.aliyuncs.com/img/01.png" alt="img"></p> <h2 id="redo-log"><a href="#redo-log" class="header-anchor">#</a> redo log</h2> <h3 id="简介"><a href="#简介" class="header-anchor">#</a> 简介</h3> <p><code>redo log</code> 是 <strong>物理日志</strong>, 记录内容是 &quot;在某个数据页上做了什么修改&quot;, 属于 <code>InnoDB</code> 存储引擎</p> <p><code>redo log</code> (重做日志) 是 <code>InnoDB</code> 存储引擎独有的, 它让 <code>MySQL</code> 拥有了崩溃恢复的能力</p> <p>比如 <code>MySQL</code> 实例挂了或宕机了, 重启时, <code>InnoDB</code> 存储引擎会使用 <code>redo log</code> 恢复数据, 保证数据的 <strong>持久性</strong> 与 <strong>完整性</strong></p> <blockquote><p>图示</p></blockquote> <p><img src="https://typora-photo-yixihan.oss-cn-chengdu.aliyuncs.com/img/02.png" alt="img"></p> <h3 id="原理"><a href="#原理" class="header-anchor">#</a> 原理</h3> <p><code>MySQL</code> 中数据是以页为单位, 你查询一条记录, 会从硬盘把一页的数据加载出来, 加载出来的数据叫数据页, 会放入到 <code>Buffer Pool</code> 中</p> <p>后续的查询都是先从 <code>Buffer Pool</code> 中找, 没有命中再去硬盘加载, 减少硬盘 <code>IO</code> 开销, 提升性能。</p> <p>更新表数据的时候, 也是如此, 发现 <code>Buffer Pool</code> 里存在要更新的数据, 就直接在 <code>Buffer Pool</code> 里更新。</p> <p><strong>然后会把&quot;在某个数据页上做了什么修改&quot;记录到重做日志缓存（<code>redo log buffer</code>）里, 接着刷盘到 <code>redo log</code> 文件里</strong></p> <blockquote><p>图示</p></blockquote> <p><img src="https://typora-photo-yixihan.oss-cn-chengdu.aliyuncs.com/img/image-20220708141703421.png" alt="image-20220708141703421"></p> <p>理想情况下, 事务一提交就会进行刷盘操作, 但实际上, 刷盘的时机是根据策略来进行的</p> <blockquote><p>redo log 组成</p></blockquote> <p>每条 redo 记录由**&quot;表空间号 + 数据页号 + 偏移量 + 修改数据长度 + 具体修改的数据&quot;**组成</p> <h3 id="刷盘时机"><a href="#刷盘时机" class="header-anchor">#</a> 刷盘时机</h3> <p><code>InnoDB</code> 存储引擎为 <code>redp log</code> 的刷盘策略提供了 <code>innodb_flush_log_at_trx_commit</code> 参数, 它支持三种策略 :</p> <ul><li>0 : 设置为 0 的时候, 表示 <strong>每次事务提交时不进行刷盘操作</strong></li> <li>1: 设置为 1 的时候, 表示 <strong>每次事务提交时都将进行刷盘操作</strong> (默认值)</li> <li>2 : 设置为 2 的时候, 表示 <strong>每次事务提交时都只把 <code>redo log buffer</code> 内容写入 <code>page cache</code></strong></li></ul> <p><code>innodb_flush_log_at_trx_commit</code> 参数默认值为 1, 也就是说当事务提交时会调用 <code>fsync</code> 对 <code>redo log</code> 进行刷盘</p> <p>另外, <code>InnoDB</code> 存储引擎有一个后台线程, 每隔 1 秒, 就会把 <code>redo log buffer</code> 中的内容写到 文件系统缓存 <code>page cache</code>, 然后调用 <code>fsync</code> 刷盘</p> <blockquote><p>图示</p></blockquote> <p><img src="https://typora-photo-yixihan.oss-cn-chengdu.aliyuncs.com/img/04.png" alt="img"></p> <p>也就是说, 一个没有提交事务的 <code>redo log</code> 记录, 也可能会刷盘</p> <p>因为在事务执行过程 <code>redo log</code> 记录是会写入<code>redo log buffer</code> 中, 这些 <code>redo log</code> 记录会被后台线程刷盘。</p> <p>除了后台线程每秒 1 次的轮询操作, 还有一种情况, 当 <code>redo log buffer</code> 占用的空间即将达到 <code>innodb_log_buffer_size</code> 一半的时候, 后台线程会主动刷盘</p> <blockquote><p>图示</p></blockquote> <p><img src="https://typora-photo-yixihan.oss-cn-chengdu.aliyuncs.com/img/05.png" alt="img"></p> <h4 id="innodb-flush-log-at-trx-commit-0"><a href="#innodb-flush-log-at-trx-commit-0" class="header-anchor">#</a> innodb_flush_log_at_trx_commit = 0</h4> <blockquote><p>图示</p></blockquote> <p><img src="https://typora-photo-yixihan.oss-cn-chengdu.aliyuncs.com/img/06.png" alt="img"></p> <p>为 0 时，如果 <code>MySQL</code> 挂了或宕机可能会有 1 秒数据的丢失</p> <h4 id="innodb-flush-log-at-trx-commit-1"><a href="#innodb-flush-log-at-trx-commit-1" class="header-anchor">#</a> innodb_flush_log_at_trx_commit = 1</h4> <blockquote><p>图示</p></blockquote> <p><img src="https://typora-photo-yixihan.oss-cn-chengdu.aliyuncs.com/img/07.png" alt="img"></p> <p>为 1 时, 只要事务提交成功, <code>redo log</code> 记录就一定会在硬盘里, 不会有任何数据丢失</p> <p>如果事务执行期间 <code>MySQL</code> 挂了或宕机了, 这部分日记丢了, 但是事务并没有提交, 所以日志丢了也不会有数据丢失</p> <h4 id="innodb-flush-log-at-trx-commit-2"><a href="#innodb-flush-log-at-trx-commit-2" class="header-anchor">#</a> innodb_flush_log_at_trx_commit = 2</h4> <blockquote><p>图示</p></blockquote> <p><img src="https://typora-photo-yixihan.oss-cn-chengdu.aliyuncs.com/img/09.png" alt="img"></p> <p>为 2 时, 只要事务提交成功, <code>redo log buffer</code> 中的内容只会写入文件系统缓存 <code>page cache</code></p> <p>如果仅仅只是 <code>MySQL</code> 挂了不会有任何数据丢失, 但是宕机可能会有 1 秒数据的丢失</p> <h3 id="日志文件组"><a href="#日志文件组" class="header-anchor">#</a> 日志文件组</h3> <h4 id="简介-2"><a href="#简介-2" class="header-anchor">#</a> 简介</h4> <p>硬盘上存储的 <code>redo log</code> 日志文件不止一个, 而是以一个 <strong>日志文件组</strong> 的形式出现的, 每个的 <code>redo</code> 日志文件大小都是一样的</p> <p>比如可以配置为一组 4 个文件, 每个文件的大小都是 <code>1GB</code>, 整个 <code>redo log</code> 日志文件可以记录 <code>4GB</code> 的内容</p> <h4 id="原理-2"><a href="#原理-2" class="header-anchor">#</a> 原理</h4> <p>它采用的 <strong>环形数组</strong> 形式, 从头开始写, 写到末尾又回到头循环写</p> <blockquote><p>图示</p></blockquote> <p><img src="https://typora-photo-yixihan.oss-cn-chengdu.aliyuncs.com/img/10.png" alt="img"></p> <p>在 <strong>日志文件组</strong> 中还有两个重要的属性, 为</p> <ul><li><code>write pos</code> : 当前记录的位置, 一边写一边后移</li> <li><code>checkpoint</code> : 当前要擦除的位置, 一边擦一边后移</li></ul> <p>每次刷盘 <code>redo log</code> 记录到 <strong>日志文件组</strong> 中, <code>write pos</code> 位置就会向后移更新</p> <p>每次 <code>MySQL</code> 加载 <code>日志文件组</code> 恢复数据时, 会清空加载过的 <code>redo log</code> 记录, 并把 <code>checkpoint</code> 后移更新</p> <p><code>write pos</code> 和 <code>checkpoint</code> 之间还空着的部分可以用来写入新的 <code>redo log</code> 记录</p> <blockquote><p>图示</p></blockquote> <p><img src="https://typora-photo-yixihan.oss-cn-chengdu.aliyuncs.com/img/11.png" alt="img"></p> <p>如果 <code>write pos</code> 追上 <code>checkpoint</code>, 表示 <strong>日志文件组</strong> 满了, 这时候不能再写入新的 <code>redo log</code> 记录, <code>MySQL</code> 得停下来. 清空一些记录, 把 <code>checkpoint</code> 推进一下</p> <blockquote><p>图示</p></blockquote> <p><img src="https://typora-photo-yixihan.oss-cn-chengdu.aliyuncs.com/img/12.png" alt="img"></p> <h3 id="redo-log-总结"><a href="#redo-log-总结" class="header-anchor">#</a> redo log 总结</h3> <blockquote><p>redo log 意义</p></blockquote> <p>数据页大小是 <code>16KB</code>, 刷盘比较耗时, 可能就修改了数据页里的几 <code>Byte</code> 数据, 没有必要把完整的数据页刷盘</p> <p>而且数据页刷盘是随机写, 因为一个数据页对应的位置可能在硬盘文件的随机位置, 所以性能是很差</p> <p>如果是写 <code>redo log</code>, 一行记录可能就占几十 <code>Byte</code>, 只包含表空间号、数据页号、磁盘文件偏移量、更新值, 再加上是顺序写, 所以刷盘速度很快</p> <p>所以用 <code>redo log</code> 形式记录修改内容, 性能会远远超过刷数据页的方式, 这也让数据库的并发能力更强</p> <h2 id="bin-log"><a href="#bin-log" class="header-anchor">#</a> bin log</h2> <h3 id="简介-3"><a href="#简介-3" class="header-anchor">#</a> 简介</h3> <p><code>bin log</code> 是 <strong>逻辑日志</strong>, 记录内容是语句的原始逻辑, 类似于 &quot;给 ID = 2 这一行的 c 字段加 1&quot;, 属于 <code>MySQL Server</code> 层</p> <p>不管是什么存储引擎, 只要发生了表数据更新, 都会产生 <code>bin log</code> 日志</p> <h3 id="用途"><a href="#用途" class="header-anchor">#</a> 用途</h3> <blockquote><p>一句话概述</p></blockquote> <p><strong>保证数据的一致性</strong></p> <p><code>MySQL</code> 数据库的 <strong>数据备份</strong>, <strong>主备</strong>, <strong>主主</strong>, <strong>主从</strong> 都离不开 <code>bin log</code>, 需要依靠 <code>bin log</code> 来同步数据, <strong>保证数据的一致性</strong></p> <blockquote><p>图示</p></blockquote> <p><img src="https://typora-photo-yixihan.oss-cn-chengdu.aliyuncs.com/img/01-20220305234724956.png" alt="img"></p> <p><code>bin log</code> 会记录所有涉及更新数据的逻辑操作, 并且是顺序写</p> <h3 id="记录格式"><a href="#记录格式" class="header-anchor">#</a> 记录格式</h3> <p><code>bin log</code> 日志有三种格式, 可以通过 <code>binlog_format</code> 参数指定</p> <ul><li><strong>statement</strong></li> <li><strong>row</strong></li> <li><strong>mixed</strong></li></ul> <h4 id="statement"><a href="#statement" class="header-anchor">#</a> statement</h4> <p>指定为 <code>statement</code>, 记录的内容是 <code>SQL</code> 语句原文</p> <p>比如执行一条</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">update</span> T
<span class="token keyword">set</span> update_time <span class="token operator">=</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">where</span> id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>记录的内容如下所示</p> <p><img src="https://typora-photo-yixihan.oss-cn-chengdu.aliyuncs.com/img/02-20220305234738688.png" alt="img"></p> <p>同步数据时, 会执行记录的 <code>SQL</code> 语句</p> <blockquote><p>缺点</p></blockquote> <p><strong>但是有个问题 : <code>update_time = now()</code> 这里会获取当前系统时间, 直接执行会导致与原库的数据不一致</strong></p> <p>为了解决这个问题, 就需要指定为 <code>row</code></p> <h4 id="row"><a href="#row" class="header-anchor">#</a> row</h4> <p>指定为 <code>row</code>, 记录的内容就不再是简单的 <code>SQL</code> 语句了, <strong>还包含操作的具体数据</strong></p> <p>记录的内容如下图所示</p> <p><img src="https://typora-photo-yixihan.oss-cn-chengdu.aliyuncs.com/img/03-20220305234742460.png" alt="img"></p> <blockquote><p>小贴士</p></blockquote> <p><code>row</code> 格式记录的内容看不到详细信息, 要通过 <code>mysqlbinlog</code> 工具解析出来</p> <blockquote><p>图解</p></blockquote> <p><code>update_time = now()</code> 变成了具体的时间 <code>update_time = 1627112756247</code>, 条件后面的 <code>@1 @2 @3</code> 都是该数据第 1 个 ~ 3 个字段的原始值</p> <p>这样的就能保证同步数据的一致性, 通常情况下都是指定为 <code>row</code>, 这样可以为数据库的恢复与同步带来更好的可靠性</p> <blockquote><p>缺点</p></blockquote> <ul><li><p>这样的格式, 需要更大的容量来记录, 比较占用空间</p></li> <li><p>恢复与同步时会更消耗 <code>IO</code> 资源, 影响执行速度</p></li></ul> <h4 id="mixed"><a href="#mixed" class="header-anchor">#</a> mixed</h4> <p>指定为 <code>mixed</code>, 记录的内容具具体情况决定采用 <code>row</code> 还是 <code>statement</code> 格式写入</p> <p><code>MySQL</code> 判断这条 <code>SQL</code> 语句是否可能会引起数据不一致, 如果是, 就用 <code>row</code> 格式, 否则就用 <code>statement</code> 格式</p> <h3 id="写入机制"><a href="#写入机制" class="header-anchor">#</a> 写入机制</h3> <p>事务执行过程中, 先把日志写到 <code>bin log cache</code>, 事务提交的时候, 再把 <code>bin log cache</code> 写到 <code>bin log</code> 文件中</p> <p>因为一个事务的 <code>bin log</code> 不能被拆开, 无论这个事务多大, 也要确保一次性写入, 所以系统会被每个线程分配一个块内存作为 <code>bin log cache</code></p> <p>可以通过 <code>binlog_cache_size</code> 参数控制单个线程 <code>bin log cache</code> 大小, 如果存储内容超过了这个参数, 就要暂存到磁盘 (<code>Swap</code>)</p> <blockquote><p>刷盘流程图示</p></blockquote> <p><img src="https://typora-photo-yixihan.oss-cn-chengdu.aliyuncs.com/img/04-20220305234747840.png" alt=""></p> <blockquote><p>图解</p></blockquote> <ul><li><strong>上图的 <code>write</code>, 是指把日志写入到文件系统缓存 <code>page cache</code>, 并没有把数据持久化到磁盘, 所以速度比较快</strong></li> <li><strong>上图的 <code>fsync</code>, 才是将数据持久化到磁盘的操作</strong></li></ul> <p><code>write</code> 和 <code>fsync</code> 的时机, 可以由参数 <code>sync_binlog</code> 控制, 默认为 0</p> <h4 id="sync-binlog-0"><a href="#sync-binlog-0" class="header-anchor">#</a> sync_binlog = 0</h4> <p>当参数指定为 0 的时候, 表示 <strong>每次提交都只 <code>write</code>, 由系统自行判断什么时候执行 <code>fsync</code></strong></p> <blockquote><p>图示</p></blockquote> <p><img src="https://typora-photo-yixihan.oss-cn-chengdu.aliyuncs.com/img/05-20220305234754405.png" alt="img"></p> <blockquote><p>优点</p></blockquote> <ul><li>性能比较高</li></ul> <blockquote><p>缺点</p></blockquote> <ul><li>如果 <code>MySQL</code> 宕机, <code>page cache</code> 里面的 <code>bin log</code> 会丢失</li></ul> <h4 id="sync-binlog-1"><a href="#sync-binlog-1" class="header-anchor">#</a> sync_binlog = 1</h4> <p>当参数指定为 1 的时候, 表示 <strong>每次提交都会执行 <code>write</code> 和 <code>fsync</code></strong>, 就如同 <code>redo log</code> 日志刷盘一样</p> <h4 id="sync-binlog-n-n-1"><a href="#sync-binlog-n-n-1" class="header-anchor">#</a> sync_binlog = N (N &gt; 1)</h4> <p>当参数指定为 N (N &gt; 1) 时, 表示 <strong>每次提交事务都 <code>write</code>, 但累计 N 个事物后才 <code>fsync</code></strong></p> <blockquote><p>图示</p></blockquote> <p><img src="https://typora-photo-yixihan.oss-cn-chengdu.aliyuncs.com/img/06-20220305234801592.png" alt="img"></p> <blockquote><p>用途</p></blockquote> <p>在出现 <code>IO</code> 瓶颈的场景里, 将 <code>sync_binlog</code> 设置成一个比较大的值, 可以提升性能</p> <p>同样的, 如果 <code>MySQL</code> 宕机, 会丢失最近 N 个事物的 <code>bin log</code> 日志</p> <h2 id="两阶段提交"><a href="#两阶段提交" class="header-anchor">#</a> 两阶段提交</h2> <p><code>redo log</code> 让 <code>InnoDB</code> 存储引擎拥有了崩溃恢复能力</p> <p><code>bin log</code> 保证了 <code>MySQL</code> 集群架构的数据一致性</p> <p>虽然两者都属于持久化的保证, 但是侧重点不同</p> <p>在执行更新语句过程, 会记录 <code>redo log</code> 与 <code>bin log</code> 两块日志, 以基本的事务为单位, <code>redo log</code>  在事务执行过程中key不断写入, 而 <code>bin log</code> 只有在事务提交时才写入, 所以 <code>redo log</code> 与 <code>bin log</code> 的写入时机不一样</p> <blockquote><p>图示</p></blockquote> <p><img src="https://typora-photo-yixihan.oss-cn-chengdu.aliyuncs.com/img/01-20220305234816065.png" alt="img"></p> <blockquote><p><code>redo log</code> 和 <code>bin log</code> 两份日志之间逻辑不一致, 会出现什么问题 ?</p></blockquote> <p>我们以 <code>update</code> 语句为例, 假设 <code>id = 2</code> 的记录, 字段 <code>c</code> 值是 0, 把字段 <code>c</code> 值更新成 1, <code>SQL</code> 语句为 <code>update T set c = 1 where id = 2</code></p> <p>假设执行过程中写完 <code>redo log</code> 日志后, <code>bin log</code> 日志写入期间发送了异常, 会出现什么情况呢?</p> <p><img src="https://typora-photo-yixihan.oss-cn-chengdu.aliyuncs.com/img/02-20220305234828662.png" alt="img"></p> <p>由于 <code>binlog</code> 没写完就异常, 这时候 <code>binlog</code> 里面没有对应的修改记录. 因此, 之后用 <code>binlog</code> 日志恢复数据时, 就会少这一次更新, 恢复出来的这一行 <code>c</code> 值是 0, 而原库因为 <code>redo log</code> 日志恢复, 这一行 <code>c</code> 值是 1, 最终数据不一致</p> <p><img src="https://typora-photo-yixihan.oss-cn-chengdu.aliyuncs.com/img/03-20220305235104445.png" alt="img"></p> <p>为了解决两份日志之间的逻辑一致问题, <code>InnoDB</code> 存储引擎使用 <strong>两阶段提交</strong> 方案</p> <p>原理很简单, 将 <code>redo log</code> 的写入拆成了两个步骤 <code>prepare</code> 和 <code>commit</code> , 这就是<strong>两阶段提交</strong></p> <p><img src="https://typora-photo-yixihan.oss-cn-chengdu.aliyuncs.com/img/04-20220305234956774.png" alt="img"></p> <p>使用 <strong>两阶段提交</strong> 后, 写入 <code>binlog</code> 时发生异常也不会有影响, 因为 <code>MySQL</code> 根据 <code>redo log</code> 日志恢复数据时, 发现 <code>redo log</code> 还处于 <code>prepare</code> 阶段, 并且没有对应 <code>binlog</code> 日志, 就会回滚该事务</p> <p><img src="https://typora-photo-yixihan.oss-cn-chengdu.aliyuncs.com/img/05-20220305234937243.png" alt="img"></p> <p>再看一个场景, <code>redo log</code> 设置 <code>commit</code> 阶段发生异常, 那会不会回滚事务呢?</p> <p><img src="https://typora-photo-yixihan.oss-cn-chengdu.aliyuncs.com/img/06-20220305234907651.png" alt="img"></p> <p>并不会回滚事务, 它会执行上图框住的逻辑, 虽然 <code>redo log</code> 是处于 <code>prepare</code> 阶段，但是能通过事务 <code>id</code> 找到对应的 <code>binlog</code> 日志, 所以 <code>MySQL</code> 认为是完整的, 就会提交事务恢复数据</p> <h2 id="undo-log"><a href="#undo-log" class="header-anchor">#</a> undo log</h2> <p>我们知道如果想要保证事务的 <strong>原子性</strong>, 就需要在异常发生时, 对已经执行的操作进行<strong>回滚</strong>, 在 MySQL 中, 恢复机制是通过 <strong>回滚日志 (undo log)</strong> 实现的, 所有事务进行的修改都会先记录到这个回滚日志中, 然后再执行相关的操作. 如果执行过程中遇到异常的话, 我们直接利用 <strong>回滚日志</strong> 中的信息将数据回滚到修改之前的样子即可. 并且, 回滚日志会先于数据持久化到磁盘上. 这样就保证了即使遇到数据库突然宕机等情况, 当用户再次启动数据库的时候, 数据库还能够通过查询回滚日志来回滚将之前未完成的事务</p> <p>另外, <code>MVCC</code> 的实现依赖于：<strong>隐藏字段、Read View、undo log</strong>. 在内部实现中, <code>InnoDB</code> 通过数据行的 <code>DB_TRX_ID</code> 和 <code>Read View</code> 来判断数据的可见性, 如不可见, 则通过数据行的 <code>DB_ROLL_PTR</code> 找到 <code>undo log</code> 中的历史版本. 每个事务读到的数据版本可能是不一样的, 在同一个事务中, 用户只能看到该事务创建 <code>Read View</code> 之前已经提交的修改和该事务本身做的修改</p> <h3 id="用途-2"><a href="#用途-2" class="header-anchor">#</a> 用途</h3> <p><strong>保证数据的原子性</strong></p> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p><code>MySQL InnoDB</code> 存储引擎<strong>使用 <code>redo log (重做日志)</code> 保证事务的持久性</strong>, 使用  <strong><code>undo log (回滚日志)</code> 保证事务的原子性</strong></p> <p><code>MySQL</code> 数据库的 <strong>数据备份, 主备, 主主, 主从</strong> 都离不开 <code>bin log</code>, 需要依靠 <code>bin log</code> 来同步数据, <strong>保证数据的一致性</strong></p></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新时间: </span> <span class="time">2022/12/31 下午3:20:26</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/blogs/面经/MySQL/MySQL优化.html" class="prev">
          MySQL - 优化
        </a></span> <span class="next"><a href="/blogs/面经/MySQL/MySQL索引.html">
          MySQL - 索引
        </a></span></p></div> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-b57cc07c data-v-7dd95ae2><li class="level-2" data-v-b57cc07c><a href="/blogs/%E9%9D%A2%E7%BB%8F/MySQL/MySQL%E6%97%A5%E5%BF%97.html#redo-log" class="sidebar-link reco-side-redo-log" data-v-b57cc07c>redo log</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/%E9%9D%A2%E7%BB%8F/MySQL/MySQL%E6%97%A5%E5%BF%97.html#简介" class="sidebar-link reco-side-简介" data-v-b57cc07c>简介</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/%E9%9D%A2%E7%BB%8F/MySQL/MySQL%E6%97%A5%E5%BF%97.html#原理" class="sidebar-link reco-side-原理" data-v-b57cc07c>原理</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/%E9%9D%A2%E7%BB%8F/MySQL/MySQL%E6%97%A5%E5%BF%97.html#刷盘时机" class="sidebar-link reco-side-刷盘时机" data-v-b57cc07c>刷盘时机</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/%E9%9D%A2%E7%BB%8F/MySQL/MySQL%E6%97%A5%E5%BF%97.html#日志文件组" class="sidebar-link reco-side-日志文件组" data-v-b57cc07c>日志文件组</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/%E9%9D%A2%E7%BB%8F/MySQL/MySQL%E6%97%A5%E5%BF%97.html#redo-log-总结" class="sidebar-link reco-side-redo-log-总结" data-v-b57cc07c>redo log 总结</a></li><li class="level-2" data-v-b57cc07c><a href="/blogs/%E9%9D%A2%E7%BB%8F/MySQL/MySQL%E6%97%A5%E5%BF%97.html#bin-log" class="sidebar-link reco-side-bin-log" data-v-b57cc07c>bin log</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/%E9%9D%A2%E7%BB%8F/MySQL/MySQL%E6%97%A5%E5%BF%97.html#简介-3" class="sidebar-link reco-side-简介-3" data-v-b57cc07c>简介</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/%E9%9D%A2%E7%BB%8F/MySQL/MySQL%E6%97%A5%E5%BF%97.html#用途" class="sidebar-link reco-side-用途" data-v-b57cc07c>用途</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/%E9%9D%A2%E7%BB%8F/MySQL/MySQL%E6%97%A5%E5%BF%97.html#记录格式" class="sidebar-link reco-side-记录格式" data-v-b57cc07c>记录格式</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/%E9%9D%A2%E7%BB%8F/MySQL/MySQL%E6%97%A5%E5%BF%97.html#写入机制" class="sidebar-link reco-side-写入机制" data-v-b57cc07c>写入机制</a></li><li class="level-2" data-v-b57cc07c><a href="/blogs/%E9%9D%A2%E7%BB%8F/MySQL/MySQL%E6%97%A5%E5%BF%97.html#两阶段提交" class="sidebar-link reco-side-两阶段提交" data-v-b57cc07c>两阶段提交</a></li><li class="level-2" data-v-b57cc07c><a href="/blogs/%E9%9D%A2%E7%BB%8F/MySQL/MySQL%E6%97%A5%E5%BF%97.html#undo-log" class="sidebar-link reco-side-undo-log" data-v-b57cc07c>undo log</a></li><li class="level-3" data-v-b57cc07c><a href="/blogs/%E9%9D%A2%E7%BB%8F/MySQL/MySQL%E6%97%A5%E5%BF%97.html#用途-2" class="sidebar-link reco-side-用途-2" data-v-b57cc07c>用途</a></li><li class="level-2" data-v-b57cc07c><a href="/blogs/%E9%9D%A2%E7%BB%8F/MySQL/MySQL%E6%97%A5%E5%BF%97.html#总结" class="sidebar-link reco-side-总结" data-v-b57cc07c>总结</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/assets/js/app.d7bd471b.js" defer></script><script src="/assets/js/3.e4073929.js" defer></script><script src="/assets/js/1.de47dd8b.js" defer></script><script src="/assets/js/40.24ac40da.js" defer></script>
  </body>
</html>
